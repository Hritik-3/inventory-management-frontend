<div class="container p-3">
  <h2>Production Schedule Management</h2>

  <!-- Message -->
  <div *ngIf="message" class="alert alert-info mt-2">{{ message }}</div>

  <!-- Raw Material Errors -->
  <div *ngIf="rawMaterialErrors.length > 0" class="alert alert-danger mt-2">
    <p>Insufficient raw materials:</p>
    <ul>
      <li *ngFor="let err of rawMaterialErrors">{{ err }}</li>
    </ul>
  </div>

  <!-- Form -->
  <form [formGroup]="scheduleForm" (ngSubmit)="createSchedule()" class="mt-3">
    <div class="mb-3">
      <label>Product ID</label>
      <input type="number" formControlName="productId" class="form-control" placeholder="Enter product ID">
    </div>

    <div class="mb-3">
      <label>Quantity</label>
      <input type="number" formControlName="quantity" class="form-control" placeholder="Enter quantity">
    </div>

    <div class="mb-3">
      <label>Start Date</label>
      <input type="date" formControlName="startDate" class="form-control">
    </div>

    <div class="mb-3">
      <label>End Date</label>
      <input type="date" formControlName="endDate" class="form-control">
    </div>

    <button type="submit" class="btn btn-primary">Create Schedule</button>
    <button type="button" class="btn btn-secondary ms-2" (click)="autoScheduleLowStock()">Auto Schedule Low Stock</button>
  </form>

  <hr>

  <!-- Schedule List -->
  <h3>All Schedules</h3>

  <!-- <button class="btn btn-success mb-3" (click)="downloadReport('pdf')">Download PDF</button>
  <button class="btn btn-primary mb-3" (click)="downloadReport('excel')">Download Excel</button> -->
  
  <table class="table table-striped table-bordered mt-2">
    <thead>
      <tr>
        <th>ID</th>
        <th>Product</th>
        <th>Quantity</th>
        <th>Status</th>
        <th>Line</th>
        <th>Start</th>
        <th>End</th>
        <!-- <th>Action</th> -->
      </tr>
    </thead>
    <tbody>
      <tr *ngFor="let s of schedules">
        <td>{{ s.scheduleId }}</td>
        <td>{{ s.productName }}</td>
        <td>{{ s.quantity }}</td>
        <td>{{ s.status }}</td>
        <td>{{ s.productionLineName || '-' }}</td>
        <td>{{ s.startDate | date:'shortDate' }}</td>
        <td>{{ s.endDate | date:'shortDate' }}</td>
        <td>
          <button *ngIf="s.status !== 'COMPLETED'" class="btn btn-success btn-sm" (click)="completeSchedule(s)">Complete</button>
        </td>
      </tr>
    </tbody>
  </table>

  <h3>Low Stock Products</h3>
  <ul>
    <li *ngFor="let p of lowStockProducts">
      {{ p.productsName }} (Qty: {{ p.productsQuantity }})
      <span [class.text-success]="p.scheduled" [class.text-danger]="!p.scheduled">
        {{ p.scheduled ? '✔ Scheduled' : '✖ Not Scheduled' }}
      </span>
    </li>
  </ul>
</div>
